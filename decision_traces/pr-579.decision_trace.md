# PR Decision Trace — pr-579

## Trace Metadata
- trace_id: pr-579
- decision_class: CHANGE_REQUEST
- scope: ops/status_agent.py + truth regeneration pipeline (status-pages mirror)
- requested_by: contributor (PR author)
- reviewed_by: pending (approval required)
- timestamp_utc: 2026-02-18T17:20:00Z
- environment: production (truth-locked status page)

## Intent
Make the Status Agent regenerate **ops/reports/system_status.json** in a way that is **consistent with the governed agent registry**, so new agents (e.g., **Consistency Agent**) appear in:
- `ops/reports/system_status.json` (source of truth)
- `status/ops/reports/system_status.json` (mirrored Pages artifact)

This closes the inconsistency where:
- `/status/system_status.json` shows the agent (static UI copy / different artifact)
- `/status/ops/reports/system_status.json` does **not** (truth mirror missing it)

## Proposed Change (What)
Update `ops/status_agent.py` to:
1. **Load `agents/registry.yaml`** (if present) using a **dependency-free, deterministic** minimal parser.
2. **Merge registry agents into** `system_status["agents"]` so registry-defined agents are always represented.
3. Keep the existing deterministic baseline agents, but ensure registry can **add missing agents**.
4. Add a **failsafe** that ensures `"consistency"` exists even if the registry is missing/malformed (conservative default).
5. Keep output contracts stable:
   - Always write `ops/reports/system_status.json`
   - Always write `ops/reports/decision_trace.json` and `.jsonl`
   - Always append to `ops/agent_activity.jsonl`

## Evidence (Why this is needed)
- The status UI is rendered from truth artifacts mirrored under `/status/ops/...`.
- The workflow **copies** `ops/reports/system_status.json` → `status/ops/reports/system_status.json`.
- If `ops/reports/system_status.json` does not include the new agent, the UI cannot show it, even if other files do.
- Registry (`agents/registry.yaml`) is the canonical list of governed agents; the Status Agent should reflect it.

## Risk Assessment
- Risk level: LOW
- Reasoning:
  - No network calls, no external dependencies.
  - Deterministic parsing only; if registry missing/unparseable, agent still generates truth (safe fallback).
  - Change is additive and does not weaken governance (still PR-gated, traceable).

## Authority & Governance
- required_checks:
  - decision_trace_required: true ✅ (this artifact provides it)
  - status_validation_required: true (expected to pass; outputs remain valid JSON)
- gate_verdict: ALLOW (supervised change; no autonomous production execution)

## Alternatives Considered
1. **Manually hardcode** the Consistency Agent in `status_agent.py` only  
   - Rejected: not scalable; registry would drift from truth.
2. **Modify the mirror workflow** to copy `/status/system_status.json` instead  
   - Rejected: breaks “Single Source of Truth” discipline; truth must be `ops/reports/system_status.json`.
3. **Add PyYAML dependency**  
   - Rejected: adds dependency risk; minimal parser is sufficient for the controlled registry structure.

## Outputs (Must be explicit for downstream validation)
- ops/reports/system_status.json
- ops/reports/decision_trace.json
- ops/reports/decision_trace.jsonl
- ops/agent_activity.jsonl

## Expected Result
- After merge + next Status Monitoring run:
  - `https://www.virtauto.de/status/ops/reports/system_status.json` contains `"consistency": {...}` under `"agents"`.
  - Status UI shows the **Consistency Agent** in “Core Agents & Layers”.
  - “STATUS AGENT (EVIDENCE)” transitions from **STALE** to **OPERATIONAL/FRESH** once the scheduled workflow republishes artifacts.
