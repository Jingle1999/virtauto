version: 1.0
last_updated: "2025-12-15T11:55:00Z"

meta:
  description: >
    GEORGE Orchestrator Rules v1.0 for virtauto.de.
    Simple event-based routing between Self-Agents.
  owner: "virtauto.OS"
  tags: ["george", "orchestrator", "routing", "self-agents"]

rules:
  # --------------------------------------------------------------
  # 1)  Mistakes & Warnings -> Self-Guardian
  # --------------------------------------------------------------
  - id: "guard-001"
    description: "Route all error/failure events to the Self-Guardian Agent."
    match:
      event: ["error", "failed", "failure"]
    action:
      target_agent: "self_guardian"
      intent: "investigate_failure"
      message: "GEORGE detected a failing workflow and requests a root-cause analysis."

  - id: "guard-002"
    description: "Route pipeline warnings to Self-Guardian for follow-up."
    match:
      event: ["warning", "degraded"]
    action:
      target_agent: "self_guardian"
      intent: "review_warning"
      message: "GEORGE noticed a degraded or warning state and asks for a review."

  # --------------------------------------------------------------
  # 2) Self-Audit -> Self-Content (Dashboard Copy / Status Snippets)
  # --------------------------------------------------------------
  - id: "content-001"
    description: "If the Self-Audit Agent completes successfully, trigger the Content Agent."
    match:
      agent: "self_audit"
      event: ["completed", "report_ready"]
    action:
      target_agent: "self_content"
      intent: "generate_dashboard_copy"
      message: "Use the latest audit findings to update dashboard texts and status snippets."

  # --------------------------------------------------------------
  # 3) Self-Content -> Deploy Agent (as soon as new content is ready)
  # --------------------------------------------------------------
  - id: "deploy-001"
    description: "If Content is ready, request a deploy via GEORGE (policy gate)."
    match:
      agent: "self_content"
      event: ["content_ready", "page_updated"]
    action:
      target_agent: "george"
      intent: "deploy_requested"
      message: "Content is ready. Please evaluate policies/health and request a safe deployment if allowed."

  # --------------------------------------------------------------
  # 4) RAG Embedding Builder -> Knowledge Agent
  # --------------------------------------------------------------
  - id: "knowledge-001"
    description: "When RAG embeddings are updated, notify the Knowledge Agent."
    match:
      agent: "rag_embedding_builder"
      event: ["embeddings_updated", "knowledge_index_refreshed"]
    action:
      target_agent: "knowledge_agent"
      intent: "reload_index"
      message: "New embeddings have been generated. Reload or re-index the RAG knowledge base."

  # --------------------------------------------------------------
  # 5) Site-Audit / External Monitoring -> Self-Guardian
  # --------------------------------------------------------------
  - id: "guard-003"
    description: "Route external site-audit issues to Self-Guardian."
    match:
      agent: ["site_audit", "external_monitor"]
      event: ["issue_detected", "uptime_alert"]
    action:
      target_agent: "self_guardian"
      intent: "handle_external_issue"
      message: "External monitoring detected issues. Please check uptime, performance, or SEO."

  # --------------------------------------------------------------
  # 6) Deploy on request (consolidated from old -name/when/then-block)
  # --------------------------------------------------------------
   - id: "deploy-req-001"
    description: "If GEORGE receives a deploy request, route to Deploy Agent."
    preconditions:
      guardian_status: ["green", "yellow"]
      system_health_min: 0.6

    match:
      agent: "george"
      event: ["deploy_requested"]
    action:
      target_agent: "deploy_agent"
      intent: "orchestrate_deploy"
      message: "Deploy requested. Run safe deploy incl. healthcheck + rollback hint."

  # --------------------------------------------------------------
  # 7) Create mistakes-to-input-learning
  # --------------------------------------------------------------
   - id: "heal-001"
    description: "If a deploy fails, trigger a controlled retry flow (v0.1) and notify Guardian."
    match:
      agent: "deploy_agent"
      event: ["deploy_failed", "healthcheck_failed"]
    action:
      target_agent: "self_guardian"
      intent: "investigate_failure"
      meta:
        self_healing: true
        retry_allowed: true
        max_retries: 1
    - id: "heal-002"
      description: "Log rollback completion for observability."
      match:
        agent: "deploy_agent"
        event: ["rollback_completed"]
      action:
        target_agent: "activity_log"
        intent: "record_event"
        message: "Rollback completed."

  # --------------------------------------------------------------
  # 8) Website Monitoring -> Self-Content (Status-Update)
  # --------------------------------------------------------------
  - id: "monitor-001"
    description: "When website monitoring reports status_ok, trigger the Content Agent to create a status update."
    match:
      agent: "website_monitoring"
      event: ["status_ok"]
    action:
      target_agent: "self_content"
      intent: "create_status_update"
      message: "Website status is OK. Generate a short system status text for virtauto.de based on the current healthy state."


  # --------------------------------------------------------------
  # 9) Content-Check at 'content_health_low' (consolidated)
  # --------------------------------------------------------------
  - id: "content-health-001"
    description: "If monitoring reports low content health, ask Content Agent for improvements."
    match:
      agent: "website_monitoring"
      event: ["content_health_low"]
    action:
      target_agent: "self_content"
      intent: "suggest_improvements"
      message: "Content health is low. Propose fixes: new posts/pages + updates."

  # --------------------------------------------------------------
  # 10) Default: log everything else (Observability / No-Op)
  # --------------------------------------------------------------
  - id: "noop-001"
    description: "Catch-all for unknown events (observability only)."
    match: {}
    action:
      target_agent: "george"
      intent: "log_event"
      message: "Unknown event type - record in GEORGE log for later analysis."
